# This hook has to be commited and pushed in order to have effect!
# This is supposed to run under ppt user, not under root!

info "Removing old upstart scripts."
rm /etc/init/$NAME.*.conf 2> /dev/null

# Upstart.
for script in upstart/*.conf; do
  info "Installing $script"
  cp $script /etc/init/
done

# Bundler.
info "Running bundler."
bundle install

# Generate prerender files.
bundle exec ruby tasks.rb

# Services.
stop ppt.webs.in 2> /dev/null
start ppt.webs.in

# webs/presentation-web/subscribe
cd /webs/ppt/webs/presentation-web/subscribe
bundle install

stop ppt.webs.presentation-web.subscribe 2> /dev/null
start ppt.webs.presentation-web.subscribe

# Nginx.
stop nginx 2> /dev/null
start nginx
